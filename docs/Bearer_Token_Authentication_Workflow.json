{
  "format": "pedantic-workflow-v1",
  "metadata": {
    "name": "Bearer Token Authentication",
    "description": "Demonstrates how to authenticate with credentials and use the returned bearer token for subsequent API requests",
    "tags": ["authentication", "bearer-token", "oauth", "api"],
    "exportedAt": "2025-01-27T00:00:00.000Z",
    "version": "1.0.0"
  },
  "workflow": {
    "nodes": {
    "start_1": {
      "id": "start_1",
      "type": "start",
      "title": "Start",
      "position": { "x": 100, "y": 300 }
    },
    "python_credentials": {
      "id": "python_credentials",
      "type": "python",
      "title": "Prepare Credentials",
      "code": "def run(input):\n    # Prepare credentials for authentication\n    # In a real scenario, you might get these from environment variables or a config\n    credentials = {\n        'username': 'your_username',  # Replace with actual username\n        'password': 'your_password',  # Replace with actual password\n        # Or for API key authentication:\n        # 'api_key': 'your_api_key',\n        # 'api_secret': 'your_api_secret'\n    }\n    \n    # Some APIs require client_id and client_secret\n    # credentials = {\n    #     'client_id': 'your_client_id',\n    #     'client_secret': 'your_client_secret',\n    #     'grant_type': 'client_credentials'\n    # }\n    \n    return {\n        'credentials': credentials,\n        'auth_url': 'https://api.example.com/auth/token'  # Replace with your auth endpoint\n    }",
      "position": { "x": 300, "y": 300 }
    },
    "http_auth": {
      "id": "http_auth",
      "type": "http",
      "title": "Authenticate & Get Token",
      "config": {
        "method": "POST",
        "url": "{auth_url}",
        "headers": {
          "Content-Type": "application/json"
        },
        "body": "{\n  \"username\": \"{credentials.username}\",\n  \"password\": \"{credentials.password}\"\n}",
        "timeout": 30
      },
      "position": { "x": 500, "y": 300 }
    },
    "python_extract_token": {
      "id": "python_extract_token",
      "type": "python",
      "title": "Extract Bearer Token",
      "code": "def run(input):\n    # Extract the bearer token from the authentication response\n    # The token might be in different fields depending on the API:\n    # - 'access_token' (OAuth2)\n    # - 'token' (some APIs)\n    # - 'authToken' (others)\n    # - 'data.token' (nested)\n    \n    response_data = input.get('data', {})\n    \n    # Try common token field names\n    token = (\n        response_data.get('access_token') or\n        response_data.get('token') or\n        response_data.get('authToken') or\n        response_data.get('bearer_token') or\n        response_data.get('data', {}).get('token')\n    )\n    \n    if not token:\n        return {\n            'error': 'Token not found in response',\n            'response': response_data\n        }\n    \n    # Also extract token type and expiry if available\n    token_type = response_data.get('token_type', 'Bearer')\n    expires_in = response_data.get('expires_in', None)\n    \n    return {\n        'token': token,\n        'token_type': token_type,\n        'expires_in': expires_in,\n        'authorization_header': f'{token_type} {token}'\n    }",
      "position": { "x": 700, "y": 300 }
    },
    "json_view_token": {
      "id": "json_view_token",
      "type": "json",
      "title": "View Token Info",
      "config": {
        "content_key": "token, token_type, expires_in"
      },
      "position": { "x": 900, "y": 300 }
    },
    "python_prepare_api_request": {
      "id": "python_prepare_api_request",
      "type": "python",
      "title": "Prepare API Request",
      "code": "def run(input):\n    # Prepare an authenticated API request using the bearer token\n    authorization_header = input.get('authorization_header', '')\n    \n    if not authorization_header:\n        return {\n            'error': 'No authorization header available'\n        }\n    \n    return {\n        'api_url': 'https://api.example.com/v1/data',  # Replace with your API endpoint\n        'authorization_header': authorization_header,\n        'method': 'GET'  # or 'POST', 'PUT', etc.\n    }",
      "position": { "x": 1100, "y": 300 }
    },
    "http_authenticated_request": {
      "id": "http_authenticated_request",
      "type": "http",
      "title": "Authenticated API Request",
      "config": {
        "method": "{method}",
        "url": "{api_url}",
        "headers": {
          "Authorization": "{authorization_header}",
          "Content-Type": "application/json"
        },
        "timeout": 30
      },
      "position": { "x": 1300, "y": 300 }
    },
    "json_view_response": {
      "id": "json_view_response",
      "type": "json",
      "title": "View API Response",
      "config": {},
      "position": { "x": 1500, "y": 300 }
    },
    "end_1": {
      "id": "end_1",
      "type": "end",
      "title": "End",
      "position": { "x": 1700, "y": 300 }
    }
    },
    "connections": {
    "start_1_to_python_credentials": {
      "source": "start_1",
      "target": "python_credentials",
      "sourceOutput": "output",
      "targetInput": "input"
    },
    "python_credentials_to_http_auth": {
      "source": "python_credentials",
      "target": "http_auth",
      "sourceOutput": "output",
      "targetInput": "input"
    },
    "http_auth_to_python_extract_token": {
      "source": "http_auth",
      "target": "python_extract_token",
      "sourceOutput": "output",
      "targetInput": "input"
    },
    "python_extract_token_to_json_view_token": {
      "source": "python_extract_token",
      "target": "json_view_token",
      "sourceOutput": "output",
      "targetInput": "input"
    },
    "python_extract_token_to_python_prepare_api_request": {
      "source": "python_extract_token",
      "target": "python_prepare_api_request",
      "sourceOutput": "output",
      "targetInput": "input"
    },
    "python_prepare_api_request_to_http_authenticated_request": {
      "source": "python_prepare_api_request",
      "target": "http_authenticated_request",
      "sourceOutput": "output",
      "targetInput": "input"
    },
    "http_authenticated_request_to_json_view_response": {
      "source": "http_authenticated_request",
      "target": "json_view_response",
      "sourceOutput": "output",
      "targetInput": "input"
    },
    "json_view_response_to_end_1": {
      "source": "json_view_response",
      "target": "end_1",
      "sourceOutput": "output",
      "targetInput": "input"
    }
    }
  }
}

