{
  "format": "pedantic-workflow-v1",
  "metadata": {
    "name": "Mixed Python TypeScript Demo",
    "description": "Demonstrates Python and TypeScript nodes working together",
    "tags": ["demo", "mixed-languages", "example"],
    "exportedAt": "2025-11-28T15:22:00.000Z",
    "version": "1.0.0"
  },
  "workflow": {
    "nodes": {
      "start": {
        "type": "start",
        "title": "Start",
        "position": { "x": 100, "y": 100 }
      },
      "python_data_generator": {
        "type": "python",
        "title": "Python Data Generator",
        "code": "import json\nimport random\nfrom datetime import datetime\n\ndef run(input):\n    # Generate sample e-commerce data\n    products = ['laptop', 'mouse', 'keyboard', 'monitor', 'headphones']\n    \n    orders = []\n    for i in range(5):\n        order = {\n            'id': f'ORD-{1000 + i}',\n            'product': random.choice(products),\n            'quantity': random.randint(1, 3),\n            'price': round(random.uniform(50.0, 500.0), 2),\n            'customer_id': f'CUST-{random.randint(100, 999)}',\n            'timestamp': datetime.now().isoformat()\n        }\n        orders.append(order)\n    \n    return {\n        'orders': orders,\n        'total_orders': len(orders),\n        'generated_at': datetime.now().isoformat(),\n        'generator': 'Python'\n    }",
        "position": { "x": 300, "y": 100 }
      },
      "typescript_processor": {
        "type": "typescript",
        "title": "TypeScript Data Processor",
        "code": "interface Order {\n  id: string;\n  product: string;\n  quantity: number;\n  price: number;\n  customer_id: string;\n  timestamp: string;\n}\n\ninterface Input {\n  orders: Order[];\n  total_orders: number;\n  generated_at: string;\n  generator: string;\n}\n\ninterface Output {\n  orders: Order[];\n  analytics: {\n    totalRevenue: number;\n    averageOrderValue: number;\n    topProduct: string;\n    customerCount: number;\n    summary: string;\n  };\n  processedBy: string;\n  processedAt: string;\n}\n\nasync function run(input: Input): Promise<Output> {\n  const orders = input.orders || [];\n  \n  // Calculate analytics using TypeScript\n  const totalRevenue = orders.reduce((sum, order) => sum + (order.price * order.quantity), 0);\n  const averageOrderValue = orders.length > 0 ? totalRevenue / orders.length : 0;\n  \n  // Find most common product\n  const productCounts = orders.reduce((counts, order) => {\n    counts[order.product] = (counts[order.product] || 0) + order.quantity;\n    return counts;\n  }, {} as Record<string, number>);\n  \n  const topProduct = Object.entries(productCounts)\n    .sort(([,a], [,b]) => b - a)[0]?.[0] || 'none';\n  \n  const uniqueCustomers = new Set(orders.map(o => o.customer_id)).size;\n  \n  return {\n    orders,\n    analytics: {\n      totalRevenue: Math.round(totalRevenue * 100) / 100,\n      averageOrderValue: Math.round(averageOrderValue * 100) / 100,\n      topProduct,\n      customerCount: uniqueCustomers,\n      summary: `Processed ${orders.length} orders, $${totalRevenue.toFixed(2)} total revenue`\n    },\n    processedBy: 'TypeScript',\n    processedAt: new Date().toISOString()\n  };\n}",
        "position": { "x": 500, "y": 100 }
      },
      "python_reporter": {
        "type": "python",
        "title": "Python Report Generator",
        "code": "import json\nfrom datetime import datetime\n\ndef run(input):\n    analytics = input.get('analytics', {})\n    orders = input.get('orders', [])\n    \n    # Generate formatted report using Python string formatting and libraries\n    report_lines = [\n        \"=== E-COMMERCE ANALYTICS REPORT ===\",\n        f\"Generated: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\",\n        \"\",\n        \"SUMMARY:\",\n        f\"• Total Orders: {len(orders)}\",\n        f\"• Total Revenue: ${analytics.get('totalRevenue', 0):.2f}\",\n        f\"• Average Order: ${analytics.get('averageOrderValue', 0):.2f}\",\n        f\"• Top Product: {analytics.get('topProduct', 'N/A')}\",\n        f\"• Unique Customers: {analytics.get('customerCount', 0)}\",\n        \"\",\n        \"TOP ORDERS:\"\n    ]\n    \n    # Sort orders by revenue and show top 3 (avoid enumerate due to RestrictedPython)\n    sorted_orders = sorted(orders, key=lambda x: x['price'] * x['quantity'], reverse=True)\n    for i in range(min(3, len(sorted_orders))):\n        order = sorted_orders[i]\n        revenue = order['price'] * order['quantity']\n        report_lines.append(f\"{i+1}. {order['product']} x{order['quantity']} = ${revenue:.2f} [{order['id']}]\")\n    \n    report_text = '\\n'.join(report_lines)\n    \n    return {\n        'report': report_text,\n        'orders': orders,\n        'analytics': analytics,\n        'report_generated_by': 'Python',\n        'report_timestamp': datetime.now().isoformat(),\n        'languages_used': ['Python (data generation)', 'TypeScript (analytics)', 'Python (reporting)']\n    }",
        "position": { "x": 700, "y": 100 }
      },
      "typescript_finalizer": {
        "type": "typescript",
        "title": "TypeScript Report Finalizer",
        "code": "interface Input {\n  report: string;\n  analytics: any;\n  orders: any[];\n  languages_used: string[];\n}\n\ninterface Output {\n  finalReport: {\n    textReport: string;\n    htmlReport: string;\n    metadata: {\n      orderCount: number;\n      totalRevenue: number;\n      languagesUsed: string[];\n      processingChain: string;\n    };\n  };\n  success: boolean;\n}\n\nasync function run(input: Input): Promise<Output> {\n  const htmlReport = input.report\n    .replace(/===/g, '')\n    .replace(/\\n/g, '<br>')\n    .replace(/•/g, '&bull;')\n    .replace(/SUMMARY:/g, '<h3>SUMMARY:</h3>')\n    .replace(/TOP ORDERS:/g, '<h3>TOP ORDERS:</h3>');\n  \n  const metadata = {\n    orderCount: input.orders?.length || 0,\n    totalRevenue: input.analytics?.totalRevenue || 0,\n    languagesUsed: input.languages_used || [],\n    processingChain: 'Start → Python (Generate) → TypeScript (Analyze) → Python (Report) → TypeScript (Finalize)'\n  };\n  \n  return {\n    finalReport: {\n      textReport: input.report,\n      htmlReport: `<div style=\"font-family: monospace; padding: 20px; border: 1px solid #ccc;\">${htmlReport}</div>`,\n      metadata\n    },\n    success: true\n  };\n}",
        "position": { "x": 900, "y": 100 }
      },
      "end": {
        "type": "end",
        "title": "End",
        "position": { "x": 1100, "y": 100 }
      }
    },
    "connections": {
      "start_python_data_generator": {
        "source": "start",
        "target": "python_data_generator",
        "sourceOutput": "output",
        "targetInput": "input"
      },
      "python_data_generator_typescript_processor": {
        "source": "python_data_generator",
        "target": "typescript_processor",
        "sourceOutput": "output",
        "targetInput": "input"
      },
      "typescript_processor_python_reporter": {
        "source": "typescript_processor",
        "target": "python_reporter",
        "sourceOutput": "output",
        "targetInput": "input"
      },
      "python_reporter_typescript_finalizer": {
        "source": "python_reporter",
        "target": "typescript_finalizer",
        "sourceOutput": "output",
        "targetInput": "input"
      },
      "typescript_finalizer_end": {
        "source": "typescript_finalizer",
        "target": "end",
        "sourceOutput": "output",
        "targetInput": "input"
      }
    },
    "metadata": {
      "nodeCount": 6,
      "lastModified": "2025-11-28T15:22:00.000Z"
    }
  }
}